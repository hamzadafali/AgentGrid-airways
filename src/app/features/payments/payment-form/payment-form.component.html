<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>payment</mat-icon>
        Paiement
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (!payment) {
        <!-- Booking Summary -->
        @if (booking) {
          <div class="booking-summary">
            <h3>Récapitulatif de la réservation</h3>
            <div class="summary-card">
              <div class="info-row">
                <mat-icon>confirmation_number</mat-icon>
                <span><strong>Référence:</strong> {{ booking.bookingReference }}</span>
              </div>
              <div class="info-row">
                <mat-icon>flight</mat-icon>
                <span><strong>Vol:</strong> {{ booking.flight.airline }} {{ booking.flight.flightNumber }}</span>
              </div>
              <div class="info-row">
                <mat-icon>route</mat-icon>
                <span><strong>Trajet:</strong> {{ booking.flight.origin }} → {{ booking.flight.destination }}</span>
              </div>
              <div class="info-row">
                <mat-icon>person</mat-icon>
                <span><strong>Passager:</strong> {{ booking.passenger.firstName }} {{ booking.passenger.lastName }}</span>
              </div>
              <div class="info-row">
                <mat-icon>event_seat</mat-icon>
                <span><strong>Siège:</strong> {{ booking.seatNumber }}</span>
              </div>
            </div>
          </div>
        }

        <!-- Payment Form -->
        <div class="payment-section">
          <h3>Informations de paiement</h3>
          <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Montant</mat-label>
              <input matInput formControlName="amount" type="number" readonly>
              <span matPrefix>€&nbsp;</span>
              <mat-icon matSuffix>euro</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Méthode de paiement</mat-label>
              <mat-select formControlName="method">
                @for (method of paymentMethods; track method) {
                  <mat-option [value]="method">
                    <mat-icon>
                      @switch (method) {
                        @case ('CREDIT_CARD') { credit_card }
                        @case ('DEBIT_CARD') { credit_card }
                        @case ('PAYPAL') { account_balance }
                      }
                    </mat-icon>
                    {{ paymentMethodLabels[method] }}
                  </mat-option>
                }
              </mat-select>
              @if (paymentForm.get('method')?.hasError('required') && paymentForm.get('method')?.touched) {
                <mat-error>La méthode de paiement est requise</mat-error>
              }
            </mat-form-field>

            <div class="total-amount">
              <span>Montant total:</span>
              <span class="amount">{{ booking?.flight?.price | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>

            <div class="actions">
              <button mat-button type="button" (click)="goToHome()">Annuler</button>
              <button mat-raised-button color="primary" type="submit" [disabled]="!paymentForm.valid">
                <mat-icon>check_circle</mat-icon>
                Payer maintenant
              </button>
            </div>
          </form>
        </div>
      } @else {
        <!-- Payment Confirmation -->
        <div class="confirmation-section">
          <div class="success-message">
            <mat-icon class="success-icon">check_circle</mat-icon>
            <h2>Paiement réussi!</h2>
            <p>Votre paiement a été traité avec succès.</p>
          </div>

          <div class="payment-details">
            <h3>Détails du paiement</h3>
            <div class="detail-card">
              <div class="detail-row">
                <strong>ID de transaction:</strong>
                <span>{{ payment.id }}</span>
              </div>
              <div class="detail-row">
                <strong>Montant:</strong>
                <span class="price">{{ payment.amount | currency:'EUR':'symbol':'1.2-2' }}</span>
              </div>
              <div class="detail-row">
                <strong>Méthode:</strong>
                <span>{{ paymentMethodLabels[payment.paymentMethod] }}</span>
              </div>
              <div class="detail-row">
                <strong>Date:</strong>
                <span>{{ payment.paymentDate | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="detail-row">
                <strong>Statut:</strong>
                <span [class]="payment.status | statusClass">{{ payment.status | status }}</span>
              </div>
            </div>
          </div>

          <div class="confirmation-actions">
            <button mat-raised-button color="primary" (click)="goToHome()">
              <mat-icon>home</mat-icon>
              Retour à l'accueil
            </button>
            <button mat-button (click)="goToBooking()">
              <mat-icon>search</mat-icon>
              Voir ma réservation
            </button>
          </div>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
